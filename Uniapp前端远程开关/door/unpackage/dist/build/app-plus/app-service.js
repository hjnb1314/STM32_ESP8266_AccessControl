if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((o=>t.resolve(e()).then((()=>o))),(o=>t.resolve(e()).then((()=>{throw o}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...o){uni.__log__?uni.__log__(e,t,...o):console[e].apply(console,[...o,t])}__definePage("pages/index/index",((e,t)=>{const o=e.__vccOpts||e;for(const[n,i]of t)o[n]=i;return o})({data:()=>({socketTask:null,info:"未连接",statusText:"未知",loading:!1,weatherText:"",showPwdModal:!0,inputPwd:"",pwdError:"",showDomainModal:!1,inputDomain:"",domainError:"",wsDomain:"ad37-219-135-121-157.ngrok-free.app"}),onLoad(){const e=uni.getStorageSync("wsDomain");e&&(this.wsDomain=e),this.getWeather()},methods:{checkPwd(){"123456"===this.inputPwd?(this.showPwdModal=!1,this.inputPwd="",this.pwdError="",this.connectWS()):(this.pwdError="密码错误，请重试",this.inputPwd="")},saveDomain(){this.inputDomain&&/^[\w\.\-]+\.ngrok\-free\.app$/.test(this.inputDomain)?(this.domainError="",this.wsDomain=this.inputDomain,uni.setStorageSync("wsDomain",this.wsDomain),this.showDomainModal=!1,this.showPwdModal||this.connectWS()):this.domainError="请输入有效ngrok域名！"},getWeather(){uni.request({url:"https://wttr.in/foshan?format=%C+%t",success:e=>{this.weatherText=e.data},fail:()=>{this.weatherText="天气获取失败"}})},connectWS(){this.socketTask&&(this.socketTask.close(),this.socketTask=null),this.info="正在连接WebSocket...";const e="wss://"+this.wsDomain;this.socketTask=uni.connectSocket({url:e,success:()=>{this.info="WebSocket连接中..."},fail:()=>{this.info="WebSocket连接失败"}}),this.socketTask.onOpen((()=>{this.info="WebSocket已连接"})),this.socketTask.onMessage((e=>{try{const t=JSON.parse(e.data);"state"===t.type&&(this.statusText=t.k?"已打开":"已关闭"),"result"===t.type&&(this.info=t.msg,this.loading=!1)}catch(t){this.info="收到非法消息"}})),this.socketTask.onError((()=>{this.info="WebSocket连接失败",this.loading=!1})),this.socketTask.onClose((()=>{this.info="WebSocket已断开",this.loading=!1}))},sendCommand(e){this.socketTask?(this.loading=!0,this.socketTask.send({data:JSON.stringify({cmd:e})}),setTimeout((()=>{this.loading=!1}),4e3)):(this.info="WebSocket未连接",this.loading=!1)},openDoor(){this.sendCommand("open")},closeDoor(){this.sendCommand("close")}}},[["render",function(t,o,n,i,a,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[a.showPwdModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"pwd-mask"},[e.createElementVNode("view",{class:"pwd-modal"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>a.inputPwd=e),password:"",maxlength:"6",placeholder:"请输入6位密码",class:"pwd-input"},null,512),[[e.vModelText,a.inputPwd]]),e.createElementVNode("button",{type:"primary",onClick:o[1]||(o[1]=(...e)=>r.checkPwd&&r.checkPwd(...e))},"确定"),a.pwdError?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error"},e.toDisplayString(a.pwdError),1)):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),a.showDomainModal?(e.openBlock(),e.createElementBlock("view",{key:1,class:"pwd-mask"},[e.createElementVNode("view",{class:"pwd-modal"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>a.inputDomain=e),placeholder:"请输入 ngrok 域名",class:"pwd-input"},null,512),[[e.vModelText,a.inputDomain]]),e.createElementVNode("button",{type:"primary",onClick:o[3]||(o[3]=(...e)=>r.saveDomain&&r.saveDomain(...e))},"保存并重连"),e.createElementVNode("button",{onClick:o[4]||(o[4]=e=>a.showDomainModal=!1)},"取消"),a.domainError?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error"},e.toDisplayString(a.domainError),1)):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"weather-card"},[e.createElementVNode("view",{class:"weather-title"},"当前天气:佛山"),a.weatherText?(e.openBlock(),e.createElementBlock("view",{key:0},e.toDisplayString(a.weatherText),1)):(e.openBlock(),e.createElementBlock("view",{key:1}," 正在加载天气... "))]),e.createElementVNode("view",{class:"info"},e.toDisplayString(a.info),1),e.createElementVNode("view",{class:"status"},"当前门禁状态："+e.toDisplayString(a.statusText),1),e.createElementVNode("button",{type:"primary",onClick:o[5]||(o[5]=(...e)=>r.openDoor&&r.openDoor(...e)),disabled:a.loading},"打开门禁",8,["disabled"]),e.createElementVNode("button",{type:"warn",onClick:o[6]||(o[6]=(...e)=>r.closeDoor&&r.closeDoor(...e)),disabled:a.loading},"关闭门禁",8,["disabled"]),e.createElementVNode("button",{onClick:o[7]||(o[7]=e=>a.showDomainModal=!0),type:"default"},"设置ngrok域名"),e.createElementVNode("view",{style:{"font-size":"24rpx",color:"#aaa","margin-top":"8rpx"}}," 当前域名: "+e.toDisplayString(a.wsDomain),1)])}]]));const o={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:n,Vuex:i,Pinia:a}={app:e.createVueApp(o)};uni.Vuex=i,uni.Pinia=a,n.provide("__globalStyles",__uniConfig.styles),n._component.mpType="app",n._component.render=()=>{},n.mount("#app")}(Vue);
